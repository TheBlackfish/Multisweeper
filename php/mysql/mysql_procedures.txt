CREATE SCHEMA `multisweeper` ;

CREATE TABLE `multisweeper`.`players` (
  `playerID` INT NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(45) NOT NULL,
  `password` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`playerID`),
  UNIQUE INDEX `username_UNIQUE` (`username` ASC));

CREATE TABLE `multisweeper`.`games` (
  `gameID` INT NOT NULL AUTO_INCREMENT,
  `map` VARCHAR(2000) NOT NULL,
  `visibility` VARCHAR(2000) NOT NULL,
  `height` INT NOT NULL,
  `width` INT NOT NULL,
  `status` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`gameID`));

CREATE TABLE `playerstatus` (
  `status` int(2) NOT NULL DEFAULT '1',
  `awaitingAction` bit(1) NOT NULL,
  `gameID` int(11) NOT NULL,
  `playerID` int(11) NOT NULL,
  `afkCount` int(4) NOT NULL DEFAULT '0',
  KEY `gameID_idx` (`gameID`),
  KEY `playerID_idx` (`playerID`),
  CONSTRAINT `gameID` FOREIGN KEY (`gameID`) REFERENCES `games` (`gameID`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `playerID` FOREIGN KEY (`playerID`) REFERENCES `players` (`playerID`) ON DELETE NO ACTION ON UPDATE NO ACTION
)

CREATE TABLE `multisweeper`.`actionqueue` (
  `gameID` INT NOT NULL,
  `playerID` INT NOT NULL,
  `actionType` BIT(1) NOT NULL,
  `xCoord` INT NOT NULL,
  `yCoord` INT NOT NULL,
  INDEX `gameID_idx` (`gameID` ASC),
  INDEX `playerID_idx` (`playerID` ASC),
  CONSTRAINT `gameID`
    FOREIGN KEY (`gameIDx`)
    REFERENCES `multisweeper`.`games` (`gameID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `playerID`
    FOREIGN KEY (`playerIDx`)
    REFERENCES `multisweeper`.`players` (`playerID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

CREATE TABLE `multisweeper`.`upcomingsignup` (
  `playerID` INT NOT NULL,
  INDEX `playerIDy_idx` (`playerID` ASC),
  CONSTRAINT `playerIDy`
    FOREIGN KEY (`playerID`)
    REFERENCES `multisweeper`.`players` (`playerID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

CREATE TABLE `multisweeper`.`globalvars` (
  `k` VARCHAR(60) NOT NULL,
  `v` VARCHAR(60) NOT NULL,
  UNIQUE INDEX `key_UNIQUE` (`key` ASC));

CREATE TABLE `multisweeper`.`chatmessages` (
  `playerID` INT(11) NOT NULL,
  `message` VARCHAR(500) NOT NULL DEFAULT 'ERROR',
  `time` DATETIME NOT NULL,
  `forCurrentGame` TINYINT(1) NOT NULL DEFAULT 1,
  INDEX `playerID_idx` (`playerID` ASC),
  CONSTRAINT `chatPlayerID`
    FOREIGN KEY (`playerID`)
    REFERENCES `multisweeper`.`players` (`playerID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);
